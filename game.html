<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic-Tac-Toe</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            color: #333;
        }
        h1 {
            text-align: center;
            margin-bottom: 10px;
        }
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        .controls, .mode-selection {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .difficulty-selection {
            display: none; /* Hidden by default */
            gap: 10px;
            margin-bottom: 10px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            border: 2px solid transparent;
            border-radius: 8px;
            background-color: #5a3e36;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }
        button:hover {
            background-color: #7a5c50;
        }
        button.active {
            background-color: #3d2b27;
            border-color: #f0f0f0;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
        }
        #status {
            font-size: 20px;
            font-weight: bold;
            height: 30px; /* Reserve space to prevent layout shift */
            color: #5a3e36;
        }
        table {
            border-collapse: collapse;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        td {
            width: 100px;
            height: 100px;
            border: 5px solid #333;
            text-align: center;
            font-size: 60px;
            font-weight: bold;
            vertical-align: middle;
            background-color: #fff;            
            transition: background-color 0.2s;
        }
        td:hover {
            background-color: #f7f7f7;
        }
        /* Remove outside borders */
        tr:first-child td { border-top: 0; }
        tr:last-child td { border-bottom: 0; }
        td:first-child { border-left: 0; }
        td:last-child { border-right: 0; }

        /* Color for X and O */
        .x-marker { color: #d9534f; }
        .o-marker { color: #5bc0de; }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Tic-Tac-Toe</h1>
        <div class="mode-selection">
            <button id="pvpButton" class="active">Player vs Player</button>
            <button id="pveButton">Player vs Bot</button>
        </div>
        <div id="difficultyControls" class="difficulty-selection">
            <button id="easyButton" class="active">Easy</button>
            <button id="mediumButton">Medium</button>
            <button id="hardButton">Unbeatable</button>
        </div>
        <div id="status">Player X's turn</div>
        <table id="gameBoard">
            <tr><td></td><td></td><td></td></tr>
            <tr><td></td><td></td><td></td></tr>
            <tr><td></td><td></td><td></td></tr>
        </table>
        <div class="controls">
            <button id="newGameButton">New Game</button>
        </div>
    </div>

    <script>
        const statusDisplay = document.getElementById('status');
        const gameBoard = document.getElementById('gameBoard');
        const cells = Array.from(document.querySelectorAll('td'));
        const newGameButton = document.getElementById('newGameButton');
        const pvpButton = document.getElementById('pvpButton');
        const pveButton = document.getElementById('pveButton');
        const difficultyControls = document.getElementById('difficultyControls');
        const easyButton = document.getElementById('easyButton');
        const mediumButton = document.getElementById('mediumButton');
        const hardButton = document.getElementById('hardButton');

        let board = ['', '', '', '', '', '', '', '', ''];
        let currentPlayer = 'X';
        let gameActive = true;
        let gameMode = 'pvp'; // 'pvp' or 'pve'
        let botDifficulty = 'easy'; // 'easy', 'medium', 'hard'

        const winningConditions = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8], // Rows
            [0, 3, 6], [1, 4, 7], [2, 5, 8], // Columns
            [0, 4, 8], [2, 4, 6]             // Diagonals
        ];

        const announce = (message) => {
            statusDisplay.innerHTML = message;
        };

        const changePlayer = () => {
            currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
            announce(`Player ${currentPlayer}'s turn`);
        };

        const isValidAction = (cell) => {
            return cell.innerHTML === '';
        };

        const updateBoard = (index) => {
            board[index] = currentPlayer;
        };

        const checkResult = () => {
            let roundWon = false;
            for (let i = 0; i < winningConditions.length; i++) {
                const winCondition = winningConditions[i];
                const a = board[winCondition[0]];
                const b = board[winCondition[1]];
                const c = board[winCondition[2]];
                if (a === '' || b === '' || c === '') {
                    continue;
                }
                if (a === b && b === c) {
                    roundWon = true;
                    break;
                }
            }

            if (roundWon) {
                announce(`Player ${currentPlayer} has won!`);
                gameActive = false;
                return;
            }

            if (!board.includes('')) {
                announce('Game ended in a draw!');
                gameActive = false;
                return;
            }
        };

        const handleCellPlayed = (clickedCell, clickedCellIndex) => {
            clickedCell.innerHTML = currentPlayer;
            clickedCell.classList.add(currentPlayer === 'X' ? 'x-marker' : 'o-marker');
            updateBoard(clickedCellIndex);
            checkResult();
        };

        const botMoveEasy = () => {
            const availableCells = board.map((val, idx) => val === '' ? idx : null).filter(val => val !== null);
            return availableCells[Math.floor(Math.random() * availableCells.length)];
        };

        const botMoveMedium = () => {
            // 1. Check for a winning move
            for (let i = 0; i < winningConditions.length; i++) {
                const [a, b, c] = winningConditions[i];
                if (board[a] === 'O' && board[b] === 'O' && board[c] === '') return c;
                if (board[a] === 'O' && board[c] === 'O' && board[b] === '') return b;
                if (board[b] === 'O' && board[c] === 'O' && board[a] === '') return a;
            }
            // 2. Check for a blocking move
            for (let i = 0; i < winningConditions.length; i++) {
                const [a, b, c] = winningConditions[i];
                if (board[a] === 'X' && board[b] === 'X' && board[c] === '') return c;
                if (board[a] === 'X' && board[c] === 'X' && board[b] === '') return b;
                if (board[b] === 'X' && board[c] === 'X' && board[a] === '') return a;
            }
            // 3. Fallback to easy move
            return botMoveEasy();
        };

        const botMoveHard = () => {
            // Minimax algorithm to find the best move
            let bestScore = -Infinity;
            let move;
            for (let i = 0; i < 9; i++) {
                if (board[i] === '') {
                    board[i] = 'O';
                    let score = minimax(board, 0, false);
                    board[i] = '';
                    if (score > bestScore) {
                        bestScore = score;
                        move = i;
                    }
                }
            }
            return move;
        };

        const minimax = (currentBoard, depth, isMaximizing) => {
            const scores = { 'X': -10, 'O': 10, 'draw': 0 };
            const winner = checkWinner(currentBoard);
            if (winner !== null) return scores[winner];

            if (isMaximizing) {
                let bestScore = -Infinity;
                for (let i = 0; i < 9; i++) {
                    if (currentBoard[i] === '') {
                        currentBoard[i] = 'O';
                        bestScore = Math.max(bestScore, minimax(currentBoard, depth + 1, false));
                        currentBoard[i] = '';
                    }
                }
                return bestScore;
            } else {
                let bestScore = Infinity;
                for (let i = 0; i < 9; i++) {
                    if (currentBoard[i] === '') {
                        currentBoard[i] = 'X';
                        bestScore = Math.min(bestScore, minimax(currentBoard, depth + 1, true));
                        currentBoard[i] = '';
                    }
                }
                return bestScore;
            }
        };

        const botMove = () => {
            if (!gameActive) return;
            let moveIndex;
            if (botDifficulty === 'easy') moveIndex = botMoveEasy();
            else if (botDifficulty === 'medium') moveIndex = botMoveMedium();
            else if (botDifficulty === 'hard') moveIndex = botMoveHard();

            if (moveIndex !== undefined) {
                handleCellPlayed(cells[moveIndex], moveIndex);
                if (gameActive) changePlayer();
            }
        };

        const handleCellClick = (event) => {
            const clickedCell = event.target;
            if (clickedCell.tagName !== 'TD' || !gameActive) {
                return;
            }

            const clickedCellIndex = cells.indexOf(clickedCell);

            if (isValidAction(clickedCell)) {
                handleCellPlayed(clickedCell, clickedCellIndex);
                if (gameActive) {
                    changePlayer();
                    if (gameMode === 'pve' && currentPlayer === 'O' && gameActive) {
                        // Bot's turn after a short delay
                        setTimeout(botMove, 500);
                    }
                }
            }
        };

        const resetGame = () => {
            board = ['', '', '', '', '', '', '', '', ''];
            gameActive = true;
            currentPlayer = 'X';
            announce(`Player ${currentPlayer}'s turn`);
            cells.forEach(cell => {
                cell.innerHTML = '';
                cell.classList.remove('x-marker', 'o-marker');
            });
        };

        const setGameMode = (mode) => {
            gameMode = mode;
            pvpButton.classList.toggle('active', mode === 'pvp');
            pveButton.classList.toggle('active', mode === 'pve');
            resetGame();
            difficultyControls.style.display = (mode === 'pve') ? 'flex' : 'none';
        };

        const setBotDifficulty = (difficulty) => {
            botDifficulty = difficulty;
            easyButton.classList.toggle('active', difficulty === 'easy');
            mediumButton.classList.toggle('active', difficulty === 'medium');
            hardButton.classList.toggle('active', difficulty === 'hard');
            resetGame();
        };

        const checkWinner = (currentBoard) => {
            for (let i = 0; i < winningConditions.length; i++) {
                const [a, b, c] = winningConditions[i];
                if (currentBoard[a] && currentBoard[a] === currentBoard[b] && currentBoard[a] === currentBoard[c]) {
                    return currentBoard[a];
                }
            }
            return currentBoard.includes('') ? null : 'draw';
        };

        gameBoard.addEventListener('click', handleCellClick);
        newGameButton.addEventListener('click', resetGame);
        pvpButton.addEventListener('click', () => setGameMode('pvp'));
        pveButton.addEventListener('click', () => setGameMode('pve'));
        easyButton.addEventListener('click', () => setBotDifficulty('easy'));
        mediumButton.addEventListener('click', () => setBotDifficulty('medium'));
        hardButton.addEventListener('click', () => setBotDifficulty('hard'));

        // Initialize
        resetGame();
    </script>
</body>
</html>
